<dom-module id="es-pur-list">

    <style>
        :host {
            @apply(--vbox-layout);
        }
    </style>

    <template>
         <sc-request-group init>
            <sc-code-group>
				<sc-code code="MT002" value="{{codes.progStsList}}"></sc-code>
			</sc-code-group>
        </sc-request-group>

		<sc-ajax id="findListRegReq"
				 url="findListRegReq.do"
				 body="{{searchParam}}"
				 last-response="{{resultList}}">
		</sc-ajax>
        
        <cc-auth-checker check-list="auth-r, auth-s"></cc-auth-checker>

        <div class="vbox flex">
        	<cc-sub-title-bar title-text="사용자 목록" ></cc-sub-title-bar>
            <cc-search-condition-panel on-search="onFindList" search-condition-cls="label-row" auth-r>
            	<cc-fieldset>
				<sc-label text="일자"></sc-label>
				<sc-period-date-field required="true" from-value="{{searchParam.from_date}}" to-value="{{searchParam.to_date}}"
									  default-from-value="-1y" default-to-value="0d" string-date="false">
				</sc-period-date-field>
			</cc-fieldset>
			
			<cc-fieldset>
				<sc-label text="요청자"></sc-label>
				<cc-user-search id="userSearch" value="{{searchParam.reqr_nm}}"
								result-field="usr_id" result-value="{{searchParam.reqr_id}}">
				</cc-user-search>
			</cc-fieldset>
			
			<cc-fieldset>
				<sc-label text="품목 코드"></sc-label>
				<cc-multi-text-field id="itemCd" value="{{searchParam.item_cd}}"
									 multi-value="{{searchParam.item_cds}}" on-enter="onEnterSearch"
									 title="품목 코드">
				</cc-multi-text-field>
			</cc-fieldset>
			
			<cc-fieldset>
				<sc-label text="품목 명"></sc-label>
				<sc-text-field value="{{searchParam.item_nm}}" on-enter="onEnterSearch"></sc-text-field>
			</cc-fieldset>
			
			<cc-fieldset>
				<sc-label text="요청 번호"></sc-label>
				<cc-multi-text-field id="itemRegReqNo" value="{{searchParam.item_reg_req_no}}"
									 multi-value="{{searchParam.item_reg_req_nos}}" on-enter="onEnterSearch"
									 title="요청 번호">
				</cc-multi-text-field>
			</cc-fieldset>
			
			<cc-fieldset>
				<sc-label text="요청 상태"></sc-label>
				<sc-combobox-field display-field="label" value-field="data"
								   items="{{codes.progStsList}}" value="{{searchParam.item_reg_req_sts_ccd}}" placeholder="전체">
				</sc-combobox-field>
			</cc-fieldset>
			
			<cc-fieldset column-span="2">
				<sc-label text="품목분류"></sc-label>
					<!-- <cc-cate-combobox-field >
					</cc-cate-combobox-field> -->
					<cc-cate-combobox-field id="itemCateField" 
						itemcat-lvl1-cd="{{searchParam.itemcat_lvl_1_cd}}" 
						itemcat-lvl2-cd="{{searchParam.itemcat_lvl_2_cd}}"
						itemcat-lvl3-cd="{{searchParam.itemcat_lvl_3_cd}}" 
						itemcat-lvl4-cd="{{searchParam.itemcat_lvl_4_cd}}">
					</cc-cate-combobox-field>
				
			</cc-fieldset>
            	
            	
            </cc-search-condition-panel>

            <sc-grid id="gridPanel" data-provider="{{resultList}}" on-item-click="onDataCellClicked" use-state="false"
				 editable="false" use-selection="true" selection-able-function="onSelectionAbleFn" class="flex">
			<cc-grid-toolbar>
				<sc-button text="신규" on-click="onAddReq" auth-s></sc-button>     <!-- 추가 시 다른 화면으로 넘어감 -->
				<sc-button text="삭제" on-click="onDeleteList" auth-s></sc-button>
			</cc-grid-toolbar>
			<sc-combobox-column data-field="item_reg_req_sts_ccd" header-text="요청 상태" width="100"
									display-field="label" value-field="data"
									items="{{codes.progStsList}}"></sc-combobox-column>
				<sc-data-column data-field="item_reg_req_no" header-text="요청 번호" width="120" style-name="link"></sc-data-column>
				<sc-combobox-column data-field="req_typ_ccd" header-text="요청 유형" width="80"
									display-field="label" value-field="data"
									items="{{codes.reqTypList}}"></sc-combobox-column>
				<sc-data-column data-field="item_cd" header-text="품목 코드" width="100"></sc-data-column>
				<sc-data-column data-field="disp_item_nm" header-text="품목 명" width="200" text-align="left"></sc-data-column>
				<sc-data-column data-field="item_spec" header-text="품목 규격" width="300" text-align="left"></sc-data-column>
				<sc-data-column data-field="mfgr_nm" header-text="제조사 명" width="80" text-align="left"></sc-data-column>
				<sc-data-column data-field="mdl_no" header-text="모델 번호" width="80" text-align="left"></sc-data-column>
				<sc-data-column data-field="itemcat_lvl_1_nm" header-text="품목분류1 명" width="100" text-align="left"></sc-data-column>
				<sc-data-column data-field="itemcat_lvl_2_nm" header-text="품목분류2 명" width="100" text-align="left"></sc-data-column>
				<sc-data-column data-field="itemcat_lvl_3_nm" header-text="품목분류3 명" width="100" text-align="left"></sc-data-column>
				<sc-data-column data-field="itemcat_lvl_4_nm" header-text="품목분류4 명" width="100" text-align="left"></sc-data-column>
				<sc-data-column data-field="reqr_nm" header-text="요청자" width="100"></sc-data-column>
				<sc-date-column data-field="reg_dttm" header-text="요청 일시" width="100"></sc-date-column>
			</sc-grid-columns>
			<sc-grid-fields>
				<sc-grid-field data-field="item_nm"></sc-grid-field>
				<sc-grid-field data-field="item_nm_en"></sc-grid-field>
			</sc-grid-fields>
		</sc-grid>
        </div>
    </template>

    <script>
        Polymer({
            is: 'es-pur-list',
            properties : {
                // 코드 데이터
                codes: {
                    type: Object,
                    reset: false,
                    value: function() {
                        return {
                            company: [],
                            useYn: []
                        };
                    }
                },

                // 조회조건
                searchParam: {
                    type: Object,
                    value: function(){
                        return {};
                    }
                },

                // 조회결과
                resultList: {
                    type: Array,
                    value: function() {
                        return [];
                    }
                }
            },

            /******************************
             * 초기화 설정
             ******************************/
            // 초기화 완료 후 호출 함수
            initialized: function() {
                var me = this;
                me.onFindList();
            },

            /******************************
             * 그리드 이벤트
             ******************************/
            // 그리드 cell click 이벤트
            onItemClick: function(event) {
                var me = this,
                    data = event.detail.data,
                    item = event.detail.item;

                if(item.dataField === "usr_id"){
                    me.fire('find-userinfo', data);
                }
            },

            /******************************
             * 버튼 이벤트
             ******************************/
            // 사용자 현황 조회
            onFindList : function() {
                var me = this;
                UT.request(me.$.findListItemReq);
                me.fire('clear');
            },

            // 사용자 저장 이후 재조회
            onReFindList : function() {
                var me = this;
                UT.request(me.$.findList);
            },

            // 사용자 현황 삭제
            onDeleteUser : function() {
                var me = this,
                    provider = me.$.gridPanel.getDataProvider();

                var checked = provider.selectionCheckedIndexes();
                if (checked.length === 0) {
                    UT.alert("STD.N1600");  // "선택된 항목이 없습니다",
                    return;
                }

                UT.confirm("STD.N1300", function() { // "삭제 하시겠습니까?"
                    var deleted = provider.removeItems();
                    if(deleted.length > 0){
                        me.$.deleteList.body = {
                            deleteUsers : deleted
                        };
                        UT.request(me.$.deleteList);
                    }
                });
            },

            // 사용자 삭제 완료
            completeDeleteList : function() {
                var me = this,
                    message = "STD.N2500"; // 삭제하였습니다.

                UT.alert(message, function(){
                    me.onFindList();
                });
            },

            // 신규 사용자 추가
            onAddUser : function() {
                var me = this;
                me.fire('init-user', "N");
            }

        });
    </script>

</dom-module>